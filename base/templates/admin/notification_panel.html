{% extends "admin/change_list.html" %}
{% load static %}

{% block content %}
<div style="padding: 20px;">
    <!-- Header -->
    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 30px; border-radius: 10px; margin-bottom: 30px; color: white;">
        <h1 style="margin: 0; font-size: 28px;">üîî Push Notification Center</h1>
        <p style="margin: 10px 0 0 0; opacity: 0.9;">Send real-time notifications to your users</p>
    </div>

    <!-- Statistics Cards -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
        <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); border-left: 4px solid #10B981;">
            <div style="font-size: 14px; color: #6B7280; margin-bottom: 5px;">Total Active Tokens</div>
            <div style="font-size: 32px; font-weight: bold; color: #10B981;">{{ total_tokens }}</div>
        </div>
        
        <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); border-left: 4px solid #3B82F6;">
            <div style="font-size: 14px; color: #6B7280; margin-bottom: 5px;">Total Users</div>
            <div style="font-size: 32px; font-weight: bold; color: #3B82F6;">{{ total_users }}</div>
        </div>
        
        <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); border-left: 4px solid #F59E0B;">
            <div style="font-size: 14px; color: #6B7280; margin-bottom: 5px;">Android Devices</div>
            <div style="font-size: 32px; font-weight: bold; color: #F59E0B;">{{ android_tokens }}</div>
        </div>
        
        <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); border-left: 4px solid #8B5CF6;">
            <div style="font-size: 14px; color: #6B7280; margin-bottom: 5px;">iOS Devices</div>
            <div style="font-size: 32px; font-weight: bold; color: #8B5CF6;">{{ ios_tokens }}</div>
        </div>
    </div>

    <!-- Send Notification Button -->
    <div style="text-align: center; margin-bottom: 30px;">
        <a href="{% url 'admin:send-notification' %}" style="display: inline-block; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px 40px; border-radius: 8px; text-decoration: none; font-size: 16px; font-weight: bold; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
            üì§ Send New Notification
        </a>
    </div>

    <!-- Recent Tokens Table -->
    <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
        <h2 style="margin-top: 0; color: #1F2937;">üì± Recent Active Devices</h2>
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="background: #F3F4F6; border-bottom: 2px solid #E5E7EB;">
                    <th style="padding: 12px; text-align: left; font-weight: 600; color: #374151;">User</th>
                    <th style="padding: 12px; text-align: left; font-weight: 600; color: #374151;">Email</th>
                    <th style="padding: 12px; text-align: left; font-weight: 600; color: #374151;">Device</th>
                    <th style="padding: 12px; text-align: left; font-weight: 600; color: #374151;">Last Updated</th>
                    <th style="padding: 12px; text-align: left; font-weight: 600; color: #374151;">Status</th>
                </tr>
            </thead>
            <tbody>
                {% for token in recent_tokens %}
                <tr style="border-bottom: 1px solid #E5E7EB;">
                    <td style="padding: 12px;">{{ token.user.get_full_name|default:token.user.username }}</td>
                    <td style="padding: 12px;">{{ token.user.email }}</td>
                    <td style="padding: 12px;">
                        <span style="padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 600; 
                            {% if token.device_type == 'android' %}background: #DBEAFE; color: #1E40AF;{% else %}background: #F3E8FF; color: #6B21A8;{% endif %}">
                            {{ token.device_type|upper }}
                        </span>
                    </td>
                    <td style="padding: 12px; color: #6B7280;">{{ token.updated_at|timesince }} ago</td>
                    <td style="padding: 12px;">
                        {% if token.is_active %}
                        <span style="color: #10B981; font-weight: 600;">‚óè Active</span>
                        {% else %}
                        <span style="color: #EF4444; font-weight: 600;">‚óè Inactive</span>
                        {% endif %}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5" style="padding: 20px; text-align: center; color: #9CA3AF;">No active tokens found</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
